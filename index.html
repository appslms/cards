<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Holographic Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        touch-action: manipulation; /* Prevents zoom on double tap on mobile */
      }
      .transform-style-preserve-3d {
        transform-style: preserve-3d;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-gray-900">
    <main class="flex flex-col items-center justify-center min-h-screen w-full text-white p-4 overflow-hidden">
      <div class="w-full max-w-md mx-auto text-center mb-8">
          <h1 class="text-4xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400 sm:text-5xl">Holographic Card FX</h1>
          <p class="mt-4 text-lg text-gray-300">Move your mouse over the card or tilt your phone to see the magic.</p>
      </div>
      
      <div class="flex flex-col items-center justify-center gap-6">
        <div 
          class="virtual-card-container relative rounded-3xl transition-transform duration-100 ease-out"
          style="width: 350px; height: 600px; transform: perspective(1500px) rotateX(0deg) rotateY(0deg);"
        >
          <div class="w-full h-full transform-style-preserve-3d rounded-3xl overflow-hidden shadow-2xl shadow-black/60">
            <!-- Layer 1: Card Artwork -->
            <img 
              src="/assets/card.png"
              alt="Virtual Card" 
              class="absolute inset-0 w-full h-full object-cover rounded-3xl"
            />
            <!-- Layer 2: Holographic Effect Layer -->
            <div 
              class="holo-effect absolute inset-0 opacity-80 mix-blend-color-dodge" 
              style="
                background-image: conic-gradient(from 180deg at 50% 50%, #2a8af6 0deg, #a33cf3 70deg, #f05285 130deg, #f7d268 200deg, #81f7ab 270deg, #2a8af6 360deg);
                background-size: 200% 200%;
                mask-image: url(/assets/mask.png);
                -webkit-mask-image: url(/assets/mask.png);
                mask-size: cover;
                -webkit-mask-size: cover;
                mask-position: center;
                -webkit-mask-position: center;
              "
            ></div>
            <!-- Layer 3: Glare Effect -->
            <div class="glare-effect absolute inset-0 mix-blend-overlay"></div>
          </div>
        </div>
        <button 
          class="gyro-button mt-4 px-6 py-3 bg-white/10 border border-white/20 rounded-lg text-white font-semibold backdrop-blur-sm hover:bg-white/20 transition-colors duration-200"
        >
          Enable Gyroscope Control
        </button>
      </div>
    </main>
    
    <script type="module">
      // --- Constants ---
      const MAX_ROTATION_X = 20;
      const MAX_ROTATION_Y = 30;

      // --- DOM Element Selection ---
      const cardContainer = document.querySelector('.virtual-card-container');
      const gyroButton = document.querySelector('.gyro-button');
      const holoEffect = cardContainer.querySelector('.holo-effect');
      const glareEffect = cardContainer.querySelector('.glare-effect');

      // --- State ---
      let rotation = { x: 0, y: 0 };
      let isGyroActive = false;

      // --- Style Update Function ---
      const updateCardStyles = () => {
        // Calculate new style values
        const glareX = (rotation.y / MAX_ROTATION_Y) * 100 + 50;
        const glareY = (-rotation.x / MAX_ROTATION_X) * 100 + 50;
        const holoX = 50 - (rotation.y / MAX_ROTATION_Y) * 20;
        const holoY = 50 - (-rotation.x / MAX_ROTATION_X) * 20;

        // Apply styles
        requestAnimationFrame(() => {
          cardContainer.style.transform = `perspective(1500px) rotateX(${rotation.x}deg) rotateY(${rotation.y}deg)`;
          holoEffect.style.backgroundPosition = `${holoX}% ${holoY}%`;
          glareEffect.style.background = `radial-gradient(circle at ${glareX}% ${glareY}%, hsla(0,0%,100%,0.4) 0%, hsla(0,0%,100%,0) 50%)`;
        });
      };

      // --- Event Handlers ---
      const handleMouseMove = (e) => {
        if (isGyroActive) return;

        const { clientX, clientY, currentTarget } = e;
        const { left, top, width, height } = currentTarget.getBoundingClientRect();
        const x = clientX - left;
        const y = clientY - top;
        
        const rotateY = MAX_ROTATION_Y * (x / width - 0.5);
        const rotateX = -MAX_ROTATION_X * (y / height - 0.5);

        rotation = { x: rotateX, y: rotateY };
        updateCardStyles();
      };

      const handleMouseLeave = () => {
        if (isGyroActive) return;
        rotation = { x: 0, y: 0 };
        updateCardStyles();
      };

      const handleDeviceOrientation = (event) => {
        const { beta, gamma } = event; // beta: front-back tilt, gamma: left-right tilt
        if (beta === null || gamma === null) return;
        
        // Clamp values to avoid extreme rotations
        const rotateX = Math.min(Math.max(beta, -MAX_ROTATION_X * 1.5), MAX_ROTATION_X * 1.5);
        const rotateY = Math.min(Math.max(gamma, -MAX_ROTATION_Y * 1.5), MAX_ROTATION_Y * 1.5);

        rotation = { x: rotateX, y: rotateY };
        updateCardStyles();
      };

      const requestDeviceOrientationPermission = async () => {
        if ('DeviceOrientationEvent' in window && typeof DeviceOrientationEvent.requestPermission === 'function') {
          try {
            const permissionState = await DeviceOrientationEvent.requestPermission();
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation', handleDeviceOrientation);
              isGyroActive = true;
              gyroButton.style.display = 'none';
            }
          } catch (error) {
            console.error("Device orientation permission request failed:", error);
            alert("Failed to get gyroscope permission.");
          }
        } else if ('DeviceOrientationEvent' in window) {
          window.addEventListener('deviceorientation', handleDeviceOrientation);
          isGyroActive = true;
          gyroButton.style.display = 'none';
        } else {
          alert("Gyroscope control is not supported on your device/browser.");
        }
      };

      // --- Initialization ---
      const init = () => {
        if (cardContainer) {
          cardContainer.addEventListener('mousemove', handleMouseMove);
          cardContainer.addEventListener('mouseleave', handleMouseLeave);
        }
        if (gyroButton) {
          gyroButton.addEventListener('click', requestDeviceOrientationPermission);
        }
        // Initial style update to set default glare/holo positions
        updateCardStyles();
      };

      // Run initialization when the document is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
